<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5HK86H1GRP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-5HK86H1GRP');
</script>
<script type="text/javascript">
  var _iub = _iub || [];
  _iub.csConfiguration = {"siteId":4248251,"cookiePolicyId":92947488,"lang":"en","storage":{"useSiteId":true}};
  </script>
  <script type="text/javascript" src="https://cs.iubenda.com/autoblocking/4248251.js"></script>
  <script type="text/javascript" src="//cdn.iubenda.com/cs/gpp/stub.js"></script>
  <script type="text/javascript" src="//cdn.iubenda.com/cs/iubenda_cs.js" charset="UTF-8" async></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <meta name="description"
    content="Voice Out Anonymously with end-to-end encryption. Echoes guarantees your privacy with 100% anonymity." />
  <meta name="keywords"
    content="anonymity, secret sharing, encrypted messaging, privacy, end-to-end encryption, anonymous communication" />
  <meta name="robots" content="index, follow" />
  <meta name="author" content="Echoes" />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Echoes - Voice Out Anonymously" />
  <meta property="og:description"
    content="Voice Out Anonymously with Echoes. Your privacy is our priority with full end-to-end encryption." />
  <meta property="og:image" content="/img/og-image.png" />
  <meta property="og:url" content="https://yourwebsite.com" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Echoes - Voice Out Anonymously" />
  <meta name="twitter:description"
    content="Voice Out Anonymously with Echoes. Your privacy is our priority with full end-to-end encryption." />
  <meta name="twitter:image" content="/img/twitter-image.png" />

  <link href="https://fonts.googleapis.com/css2?family=Baloo+2&family=Quicksand&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/ceb8cfc409.js" crossorigin="anonymous"></script>
  <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://unpkg.com/wavesurfer.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js"></script>
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="/styles/style.css" />
  <link rel="stylesheet" href="/styles/media.css" />
  <link rel="stylesheet" href="/styles/new.css" />
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
  <title>Echoes || <%= locals.title ? title : null%>
  </title>

</head>

<body class="main-background">



  <script>
    window.addEventListener("load", function () {
      window.scrollTo({ top: 0, behavior: "smooth" });
    });
  </script>


  <header>
    <div class="container">
      <div class="header">
        <!-- <img oncontextmenu="return false;" src="../../img/logo/main-logo.png" alt="" id="main-logo" class="logo">
        <img oncontextmenu="return false;" src="../../img/logo/mobile-logo.png" alt="" id="mobile-logo" class="logo"> -->

        <h1 id="main-logo" class="logo text-gradient"><i class="fas fa-microphone"></i>Echoes</h1>
        <h1 id="mobile-logo" class="logo text-gradient"><i class="fas fa-microphone"></i></h1>
    

        <form id="liveSearchForm" action="/search" method="post" autocomplete="off">
          <div class="search" id="mobileSearch">
            <button class="search-btn" type="submit" id="toggleSearch">
              <i class="fa-solid fa-magnifying-glass"></i>
            </button>
            <input name="search" type="text" id="searchInput" placeholder="Search">
          </div>
          <ul id="suggestions" class="suggestion-box"></ul>
        </form>

        <div class="topbar-icons">
          <ul id="navbar">

            <li class="navbar nav-text">
              <a class="nav-link" href="/explore" style="color: var(--text-color);">
                <i class=" fab fa-modx fa-2x"></i>
              </a>
            </li>

            <li class="navbar">
              <a class="nav-link" href="/notifications">
                <i class="fas fa-bell fa-2x"></i>
                <span class="counter">0</span>
              </a>
            </li>
            <li class="navbar profiled">
              <button class="profile-btn"><img oncontextmenu="return false;"
                  src="<%= profilePicture ? profilePicture: '../../' + profilePicture  %>" alt="" class="profile-pic thumb">
                <i class="fas fa-chevron-down"></i></button>
            </li>
            <li class="navbar dropdown">
              <div class="hamburger" id="hamburger">
                <div class="bar" id="bar1"></div>
                <div class="bar" id="bar3"></div>
              </div>
            </li>
        </div>
        <div id="menu" class="menu-hidden">
          <div class="container">
            <div class="profile-head">
              <div class="avatar-profile">
                <img oncontextmenu="return false;"
                src="<%= profilePicture ? profilePicture : '../../' + profilePicture %>" alt="Profile Avatar"
                class="profile-pic" />
              </div>
             
                <h3 class="username"><span class="username"><span>Hello,&nbsp;</span>
                  <span class="user<%= userId %>">
                   <% if(stealthMode){  %>
                    <span class="user">@voice<%= userId %></span>
                     <% } else { %>
                      <span class="user"> @<%= username %></span>
                       <% } %>
                 </span>
                    <% if(verification===true) {%>
                      <img oncontextmenu="return false;" src="../../img/gossipa3.png" alt="Verifiied Badge"
                        class="verified-badge">
                      <% } else {%>
                        <% } %>
                </span></h3>
            </div>


            <div class="menu">
              <div class="menu-nav">

                <ul class="pages">
                  <h4>Compose a gist</h4>
                  <li><a class="nav-link" href="/feeds">Listen to Voices</a></li>
                  <li><a class="nav-link" href="/submit">Echo your voice</a></li>
                  <li>
                    <a class="nav-link" href="/notifications" class="">Notifcations</a>
                  </li>
                </ul>
                <ul class="account">
                  <h4>Account</h4>
                  <li>
                    <a class="nav-link" href="/notifications" class="">Go To Profile</a>
                  </li>
                  <li><a class="nav-link" href="/profile">Edit Profile</a></li>

                  <li>
                    <form action="/logout" method="POST">
                      <button type="submit">Logout <i class="fas fa-right-from-bracket"></i></button>
                    </form>
                  </li>
                </ul>
              </div>

              <ul class="socials">
                <li>
                  <a class="nav-link" target="_blank" href="https://t.me/anonymcret"><i
                      class="fab fa-telegram fa-2x"></i></a>
                </li>
                <li>
                  <a class="nav-link" target="_blank" href=""><i class="fab fa-instagram fa-2x"></i></a>
                </li>
                <li>
                  <a class="nav-link" target="_blank" href=""><i class="fab fa-linkedin fa-2x"></i></a>
                </li>
                <li>
                  <a class="nav-link" target="_blank" href=""><i class="fab fa-github fa-2x"></i></a>
                </li>
              </ul>
              <hr />
              <div class="theme-switch">
                <button id="themeToggleBtn" class="theme-toggle-btn">ðŸŒ™&nbsp;<span class="text-gradient nav-text">Early Bird</span></button>
        </div>
        
              <div class="menu-nav-alt">
                <ul class="info">
                  <h4>Information</h4>
                  <li><a href="">About</a></li>
                  <li><a href="">Security</a></li>
                  <li><a href="">Privacy</a></li>
                  <li><a href="">Blog</a></li>
                </ul>
                <ul class="support">
                  <h4>Support</h4>
                  <li><a href="">FAQ</a></li>
                  <li><a href="">Contact</a></li>
                  <li><a href="/feedback">Reviews</a></li>
                  <li> <button id="installBtn" style="display:none;" class="install-prompt">
                      <span class="pulse-ring"></span>
                      Install Gossipa App
                      <i class="fas fa-download"></i> 
                    </button></li>

                </ul>
              </div>
              <p class="lang">
                <i class="fas fa-globe"></i> English
              </p>
              <button id="close"><i class="fas fa-xmark"></i></button>
            </div>
          </div>
        </div>
        </li>
        </ul>
      </div>
    </div>
    <div id="announcement">

    </div>
  </header>



  <div class="layout-container container">

    <aside class="left-sidebar">
        <ul class="nav">
          <li class="nav-item <%= locals.title === 'Gossip feeds' ? 'current' : null %>">
            <a href="/feeds">
              <i class="nav-icon fas fa-home"></i> &nbsp;
              <span class="nav-text">Home</span>
            </a>
          </li>
          <li class="nav-item <%= locals.title === 'Explore Your Space' ? 'current' : null %>">
            <a href="/explore">
              <i class="nav-icon fab fa-modx"></i> &nbsp;
              <span class="nav-text">Open Air</span>

              <span class="nav-tag">New</span>
            </a>
          </li>
          <li class="nav-item chief <%= locals.title === 'Saved Gists' ? 'current' : null %>">
            <a href="/bookmarked">
              <i class="nav-icon fas fa-bookmark"></i>
              &nbsp;<span class="nav-text">Bookmarks</span>&nbsp;
            </a>
          </li>
          <li class="nav-item chief">
            <a href="/subscription">
              <i class="nav-icon fas fa-award"></i>
              &nbsp;<span class="nav-text">Become a Chief</span>&nbsp;
              <span class="nav-text"><img oncontextmenu="return false;" src="../../img/gossipa3.png" alt=""
                  class="nav-icon verified-badge"></span>
                  <span class="nav-tag">Beta</span>
            </a>
          </li>
          <li class="nav-item <%= locals.title === 'My Profile' ? 'current' : null %>">
            <a href="/profile">
              <i class="nav-icon fas fa-circle-user"></i> &nbsp;
              <span class="nav-text">My Profile</span>
            </a>
          </li>
          <li class="nav-item blur">
            <a aria-disabled="true">

              <i class="nav-icon fas fa-comments"></i> &nbsp;
              <span class="nav-text">GossipaCity</span>

              <span class="nav-tag">soon</span>
            </a>
          </li>

          <li class="nav-item <%= locals.title === 'Share your Gossip' || 'Edit your Gossip' ? 'current' : null %>">
            <a href="/submit">
              <i class="fas fa-circle-plus nav-icon"></i>
              &nbsp;<span class="nav-text"> Compose Gist</span>&nbsp;
              <i class="fas fa-chevron-down nav-text"></i>
            </a>

          </li>
        </ul>

    </aside>

    <main>
      <%- body %>
    </main>

    <div id="milestone-badge" class="hidden">ðŸŽ‰ 10 Reactions! ðŸŽ‰</div>

    <div id="announcement-overlay" class="hidden">
      <div class="trumpet-animation"></div>
      <div class="overlay-content" text-align="center">
        <center>
          <h2>Announcement! ðŸŽ‡ðŸŽ†</h2>
          <h4>Top Most Discussed Gist</h4>
          <!-- <p id="pin-secret"></p> -->
          <small id="posted-by"></small>
          <div id="countdown-timer">5</div>
        </center>
      </div>
      <button id="close-announcement" class="btn btn-dark btn-lg">Close</button>
    </div>



    <!-- Content of each page will be injected here -->

    <!-- Notifications Container -->
    <div id="notification"></div>
  </div>

  
  <audio id="post-sound" src="/sounds/system-notification-199277.mp3" preload="auto"></audio>

  
<button id="scrollToTopBtn" class="scroll-btn"><i class="fas fa-chevron-up"></i></button>


<script>
  function formatCount(num) {
  if (num >= 1_000_000_000) return (num / 1_000_000_000).toFixed(1).replace(/\.0$/, "") + "b";
  if (num >= 1_000_000) return (num / 1_000_000).toFixed(1).replace(/\.0$/, "") + "m";
  if (num >= 1_000) return (num / 1_000).toFixed(1).replace(/\.0$/, "") + "k";
  return num.toString();
}
</script>

<script>
  // ðŸ”” Small helper to show toast notifications
  function showToast(message) {
    const notice = document.getElementById("notification");
    if(notice){
      notice.innerHTML = `<div class="toast">${message}</div>`;
    setTimeout(() => (notice.innerHTML = ""), 3000);
    }
  }
</script>


<script>
  document.addEventListener("DOMContentLoaded", () => {
    const scrollBtn = document.getElementById("scrollToTopBtn");

    window.addEventListener("scroll", () => {
      scrollBtn.style.display = window.scrollY > 200 ? "block" : "none";
    });

    scrollBtn.addEventListener("click", () => {
      // Animate launch
      scrollBtn.classList.add("shrink");
      scrollBtn.classList.add("launching");

      // Scroll to top
      window.scrollTo({ top: 0, behavior: "smooth" });

      // Reset animation classes after a short delay
      setTimeout(() => {
        scrollBtn.classList.remove("shrink");
        scrollBtn.classList.remove("launching");
      }, 800);
    });
  });
</script>

  <script>
    const searchWrapper = document.getElementById("mobileSearch");
    const toggleBtn = document.getElementById("toggleSearch");
    const searchInput = document.getElementById("searchInput");
    const suggestionsBox = document.getElementById("suggestions");

    let debounceTimer;

    toggleBtn.addEventListener("click", function (e) {
      if (window.innerWidth <= 768) {
        if (document.activeElement !== searchInput) {
          e.preventDefault();
          searchWrapper.classList.toggle("active");

          if (searchWrapper.classList.contains("active")) {
            searchInput.focus();
          } else {
            searchInput.value = "";
            suggestionsBox.innerHTML = "";
            suggestionsBox.style.display = "none"; // <- Hide it here
          }
        }
      } else {
        // Desktop validation
        if (searchInput.value.trim().length === 0) {
          e.preventDefault();
          suggestionsBox.innerHTML = "<li class='no-result'>Please enter a search keyword</li>";
          suggestionsBox.style.display = "block";
        }
      }
    });


    // Click outside to collapse
    document.addEventListener("click", function (e) {
      if (
        window.innerWidth <= 768 &&
        !searchWrapper.contains(e.target)
      ) {
        searchWrapper.classList.remove("active");
        searchInput.value = "";
        suggestionsBox.innerHTML = "";
      }
    });

    // Live search logic
    searchInput.addEventListener("keyup", function (e) {
      clearTimeout(debounceTimer);
      const query = this.value.trim();

      if (query.length === 0) {
        e.preventDefault()
        suggestionsBox.innerHTML = "";
        suggestionsBox.style.display = "none"; // <- Ensure it is hidden
        searchWrapper.classList.toggle("active");
        return;
      }

      suggestionsBox.style.display = "none"; // Reset before debounce

      debounceTimer = setTimeout(() => {
        fetch("/searching", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ search: query })
        })
          .then(res => res.json())
          .then(data => {
            suggestionsBox.innerHTML = "";

            if (data.searchResults.length === 0) {
              suggestionsBox.innerHTML = "<li class='no-result'>No result found</li>";
              suggestionsBox.style.display = "block"; // <- Show only when needed
              return;
            }

            suggestionsBox.style.display = "block";

            function highlightMatch(text, keyword) {
              const regex = new RegExp(`(${keyword})`, "gi");
              return text.replace(regex, "<mark>$1</mark>");
            }

            function toggleRead(e, btn, keyword) {
              e.stopPropagation();
              const textEl = btn.parentElement;
              const raw = textEl.getAttribute("data-full");
              const expanded = textEl.classList.contains("expanded");

              if (!expanded) {
                textEl.innerHTML = highlightMatch(raw, keyword);
                const newBtn = document.createElement("button");
                newBtn.textContent = "Show Less";
                newBtn.className = "read-more";
                newBtn.onclick = ev => toggleRead(ev, newBtn, keyword);
                textEl.appendChild(newBtn);
                textEl.classList.add("expanded");
              } else {
                const short = raw.slice(0, 150) + "...";
                textEl.innerHTML = highlightMatch(short, keyword);
                const newBtn = document.createElement("button");
                newBtn.textContent = "Read More";
                newBtn.className = "read";
                newBtn.onclick = ev => toggleRead(ev, newBtn, keyword);
                textEl.appendChild(newBtn);
                textEl.classList.remove("expanded");
              }
            }

            data.searchResults.forEach(item => {
              const li = document.createElement("li");
              li.classList.add("suggestion-item");

              const short = item.secret.length > 50 ? item.secret.slice(0, 50) + "..." : item.secret;
              const highlightedText = highlightMatch(item.secret, query);

              li.innerHTML = `
      <span class="arrow">â†’</span>
       <div class="search-text short-text" data-full="${item.secret.replace(/"/g, '&quot;')}">
        ${highlightedText}
        ${item.secret.length > 50 ? '<button class="read-more" onclick="toggleRead(event, this, \'' + query + '\')">Read More</button>' : ''}
      </div>
    `;

              suggestionsBox.insertBefore(li, document.getElementById("loadMore"));

              li.addEventListener("click", () => {
                window.location.href = `/secret/${item.id}`;
              });

              suggestionsBox.appendChild(li);
            });
          })
          .catch(err => {
            suggestionsBox.style.display = "none"; // fallback to hidden
            console.error("Live search error:", err);
          });
      }, 300);
    });

  </script>



  <script>
    const showAnnouncement = (secret) => {
      const overlay = document.getElementById("announcement-overlay");
      // const secretText = document.getElementById("pin-secret");
      const postedBy = document.getElementById("posted-by");
      const countdownTimer = document.getElementById("countdown-timer");
      const closeButton = document.getElementById("close-announcement");

      // secretText.textContent = `"${secret.secret}"`;
      postedBy.textContent = `Goes to ~~@anonym${secret.user_id}~~`;

      let countdown = 5;
      const countdownInterval = setInterval(() => {
        countdown -= 1;
        countdownTimer.textContent = countdown;

        if (countdown === 0) {
          clearInterval(countdownInterval);
          setTimeout(() => {
            overlay.classList.add("hidden");
            pinSecret(secret);
          }, 1000);
        }
      }, 1000);

      overlay.classList.remove("hidden");

      closeButton.addEventListener("click", () => {
        overlay.classList.add("hidden");
        pinSecret(secret);
      });
    };

  </script>

  <script>
    function updateCountdown() {
      const countdownEl = document.getElementById("countdown");
      // const announcement= document.getElementById("announcement");
      if (!countdownEl) return;

      const now = new Date();
      const nextTarget = new Date();
      nextTarget.setUTCHours(11, 0, 0, 0); // 11:00 AM GMT

      if (now > nextTarget) {
        nextTarget.setUTCDate(nextTarget.getUTCDate() + 1); // move to next day
      }

      const distance = nextTarget - now;

      const hours = String(Math.floor((distance / (1000 * 60 * 60)) % 24)).padStart(2, '0');
      const minutes = String(Math.floor((distance / (1000 * 60)) % 60)).padStart(2, '0');
      const seconds = String(Math.floor((distance / 1000) % 60)).padStart(2, '0');

      const span = document.createElement('span')
      span.textContent = `${hours}:${minutes}:${seconds}`
      // span.className = 'counter'

      countdownEl.textContent = `Next top gossip to be selected in:`;
      countdownEl.appendChild(span)
      countdownEl.style.flex = " 1 1 100% !important"
      countdownEl.style.width = "100% !important"
      span.style.color = "var(--secondary-color)"

    }

    // Start the countdown interval when DOM is ready
    document.addEventListener("DOMContentLoaded", () => {
      updateCountdown();
      setInterval(updateCountdown, 1000);
    });
  </script>


  <script>
    const reactToSecret = async (secretId, type) => {
      try {
        const response = await fetch(`/secrets/${secretId}/react`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ type }),
        });

        const data = await response.json();
        console.log(data)

        if (data.success) {
          // Update the reactions count on the UI
          const secretCard = document.querySelector(
            `[data-id="${secretId}"]`
          );
          const reactionCount = secretCard.querySelector(
            `.reaction-btn[data-type="${type}"] .reaction-count`
          );
          reactionCount.textContent = data.reactions[type] || 0;

          // Trigger confetti if milestone is reached
          if (data.milestone) {
            triggerConfetti();
            showMilestoneBadge();
          }
        } else {
          console.error(data.error);
        }
      } catch (error) {
        console.error("Error reacting:", error);
      }
    };

    function triggerConfetti() {
      confetti({
        particleCount: 100, // Number of confetti particles
        spread: 70, // Spread angle
        origin: { y: 0.6 }, // Start position
        colors: ["#ff6f61", "#ffcc00", "#66ff99", "#6699ff", "#ff99cc"], // Custom colors
      });
    }

    function showMilestoneBadge() {
      const badge = document.getElementById("milestone-badge");
      badge.classList.remove("hidden");

      setTimeout(() => {
        badge.classList.add("hidden");
      }, 5000); // 5 seconds
    }
  </script>

  <script>
    
function showNotification(message) {
  const audio = new Audio("/sounds/system-notification-199277.mp3")
  audio.play();

if(Notification.permission === 'granted'){
  new Notification('Gossipa', {
    body: message,
    icon: '/img/logo/mobile-logo.png'
  });
 } else if(Notification.permission === 'default'){
  Notification.requestPermission().then(permission => {
    if(permission === 'granted'){
      new Notification('Gossipa', {
        body: message,
        icon: '/img/logo/mobile-logo.png'
      });
    }
  });
 }
}
  </script>
  <script>
    window.currentUserId = "<%= userId %>";
    window.socket = io({ query: { userId: window.currentUserId } });
    const counter = document.querySelector(".counter");

    // Handle new notifications
    socket.on("new-notification", (data) => {
      // Increment the notification counter
      const currentCount = parseInt(counter.textContent) || 0;
      counter.textContent = currentCount + 1;

  //     if (currentCount.textContent > 99) {
  //   counter.textContent = "99+";
  // } else {
  //   counter.textContent = currentCount;
  // }

      const notificationsDiv = document.getElementById("notification");
      const notification = document.createElement("div");
      notification.className = "toast";

      const sound = document.getElementById("post-sound");
      if (sound) sound.play();

      // Display a notification if it's a "secret" type
      if (data.type === "post") {
        notification.innerHTML = `<img src="${data.data.avatar}" class="profile-pic thumb"/> ${data.data.message}`;
      } else if(data.type === "comment") {
        notification.innerText = `${data.data.message}`;
      }  else if (data.type === "selected") {
        notification.innerText = `~~@voice${data.data.userId}~~ Your echo is the top most discussed for the Day...... Keep it up!"`;
        notificationsDiv.style.textAlign = "center"

      }else if (data.type === "eavedrop"){
notification.innerText = `You are being resonated by ~~@voice${data.data.audience}~~:`;
      }
       else if (data.type === "reaction") {
        const { reaction, count, milestone } = data.data;
        notification.innerText =
          `Your echo received a new "${reaction}" reaction! Total: ${count}.`
      } else if (data.type === "stealth"){
         notification.innerText = `You ${data.data.status} stealth mode.`
      }else if (data.type === "top-secret") {
        notification.innerText = `Most discussed echo goes to ~~@voice${data.data.userId}~~"`;
      }

      function recieveNotification(data){
  showNotification(data.message);
 }

 setTimeout(() => {
  recieveNotification({message: notification.innerText})
 }, 5000)

      notificationsDiv.appendChild(notification);

      // Automatically remove the notification after 5 seconds
      setTimeout(() => {
        notification.remove();
      }, 5000);

    });
  </script>

 <script>
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', function (e) {
        e.preventDefault();
        window.brandLogo?.show();
        setTimeout(() => {
          window.location.href = this.formAction;
        }, 2400);
      });
    });
  </script>


<script src="js/app.js"></script>
  <script src="/js/defaultTheme.js"></script>
</body>

</html>